<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study App v2</title>

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    h1 {
      margin: 20px 0;
    }

    /* Flashcard styling */
    .flashcard {
      display: none;
      font-size: 28px;
      margin: 40px auto;
      padding: 30px;
      background: #fff;
      border-radius: 12px;
      width: 300px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      cursor: pointer;
    }

    /* Matching Game Layout */
    #matchingGame {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    .col {
      flex: 1;
      min-width: 140px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .word-card {
      width: 100%;
      max-width: 140px;
      height: 55px;
      font-size: 16px;
      background: #fff;
      border: 2px solid #4CAF50;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s, background 0.2s;
    }

    .word-card:hover {
      transform: scale(1.05);
      background: #f0fff0;
    }

    .word-card.selected {
      border-color: #ff9800;
      background: #fff3e0;
    }

    .word-card.matched {
      border-color: #4CAF50;
      background: #e8f5e9;
      color: #388e3c;
      pointer-events: none;
    }

    .word-card.wrong {
      border-color: red;
      background: #ffebee;
    }

    button {
      padding: 12px 20px;
      margin: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #4CAF50;
      color: #fff;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }

    button:hover {
      background: #45a049;
    }
  </style>
</head>
<body>
  <h1>ðŸ“š Study App v2</h1>

  <button onclick="startFlashcards()">Flashcards</button>
  <button onclick="startMatchingGame()">Matching Game</button>

  <!-- Flashcard -->
  <div id="flashcard" class="flashcard" onclick="flipFlashcard()"></div>

  <!-- Matching Game -->
  <div id="matchingGame"></div>

  <!-- âœ… Success + Complete Sounds -->
  <audio id="successSound" src="success.mp3" preload="auto"></audio>
  <audio id="completeSound" src="complete.mp3" preload="auto"></audio>

  <script>
    let words = [];
    let currentIndex = 0;
    let showingFront = true;

    // Load words from Google Sheets CSV
    async function loadWords() {
      const response = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vSxtWISbLyEbMQMd4snAQVRAfnyOnVz1k6lulMsUPwjEACmII-kjzznEFu2Mrrzf3Z70EJAYVsnYPRA/pub?output=csv");
      const data = await response.text();
      const rows = data.split("\n").slice(1);
      words = rows.map(r => {
        const cols = r.split(",");
        return { front: cols[0], back: cols[1] };
      });
    }

    // Flashcards
    async function startFlashcards() {
      await loadWords();
      currentIndex = 0;
      showingFront = true;
      showFlashcard();
    }

    function showFlashcard() {
      const card = document.getElementById("flashcard");
      card.style.display = "block";
      card.textContent = showingFront ? words[currentIndex].front : words[currentIndex].back;
    }

    function flipFlashcard() {
      showingFront = !showingFront;
      showFlashcard();
    }

    // Matching Game
    async function startMatchingGame() {
      await loadWords();
      const game = document.getElementById("matchingGame");
      game.innerHTML = "";

      let leftCol = document.createElement("div");
      leftCol.className = "col";
      let rightCol = document.createElement("div");
      rightCol.className = "col";

      let shuffled = [...words].sort(() => Math.random() - 0.5);

      shuffled.forEach((w, idx) => {
        let leftCard = createCard(w.front, idx);
        let rightCard = createCard(w.back, idx);
        leftCol.appendChild(leftCard);
        rightCol.appendChild(rightCard);
      });

      game.appendChild(leftCol);
      game.appendChild(rightCol);
    }

    let selected = [];
    function createCard(text, matchId) {
      let card = document.createElement("div");
      card.className = "word-card";
      card.textContent = text;
      card.dataset.match = matchId;
      card.onclick = () => {
        if (card.classList.contains("matched") || card.classList.contains("selected")) return;

        card.classList.add("selected");
        selected.push(card);

        if (selected.length === 2) {
          if (selected[0].dataset.match === selected[1].dataset.match) {
            selected.forEach(c => {
              c.classList.remove("selected");
              c.classList.add("matched");
            });
            document.getElementById("successSound").play(); // âœ… success sound
            selected = [];
            checkWin();
          } else {
            selected.forEach(c => c.classList.add("wrong"));
            setTimeout(() => {
              selected.forEach(c => {
                c.classList.remove("selected", "wrong");
              });
              selected = [];
            }, 800);
          }
        }
      };
      return card;
    }

    function checkWin() {
      const cards = document.querySelectorAll(".word-card");
      if ([...cards].every(c => c.classList.contains("matched"))) {
        document.getElementById("completeSound").play(); // âœ… complete sound
        alert("ðŸŽ‰ Congratulations! You matched all words!");
      }
    }

    // Register service worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js");
    }
  </script>
</body>
</html>
